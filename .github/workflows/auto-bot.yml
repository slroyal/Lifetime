name: 6-Hour Auto Bot

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-22.04
    timeout-minutes: 350

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Dependencies
        run: npm ci --only=production

      - name: Show Files (Debug)
        run: |
          echo "=== Files in repo ==="
          ls -la
          echo "=== package.json content ==="
          cat package.json

      - name: Run Bot with Full Logs
        run: |
          echo "Bot starting at $(date)"
          echo "Current directory: $(pwd)"
          
          # ඔයාගේ main file එක මොකක්ද කියලා මෙතන දාන්න (උදා: index.js, bot.js, main.js)
          node index.js &     # <<< මෙතන ඔයාගේ file name එක දාන්න !!!
          # හෝ node bot.js &
          # හෝ node main.js &
          
          BOT_PID=$!
          echo "Bot running with PID: $BOT_PID"
          
          # 5h 45m බලාගෙන ඉන්න (ඊළඟ schedule එකට overlap නැතුව)
          sleep 345m
          
          echo "Killing bot for next cycle..."
          kill $BOT_PID || true

      - name: Cycle Completed
        run: echo "6-hour cycle done – will auto restart soon"
